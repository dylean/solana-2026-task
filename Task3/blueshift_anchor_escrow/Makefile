.PHONY: help install build test deploy clean setup check

help:
	@echo "========================================="
	@echo "ğŸš€ Blueshift Anchor Escrow - Makefile"
	@echo "========================================="
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤ï¼š"
	@echo ""
	@echo "  make setup      - è‡ªåŠ¨è®¾ç½®é¡¹ç›®"
	@echo "  make install    - å®‰è£…ä¾èµ–"
	@echo "  make build      - æ„å»ºç¨‹åº"
	@echo "  make test       - è¿è¡Œæµ‹è¯•"
	@echo "  make deploy     - éƒ¨ç½²ç¨‹åº"
	@echo "  make clean      - æ¸…ç†æ„å»ºäº§ç‰©"
	@echo "  make check      - æ£€æŸ¥ä¾èµ–"
	@echo ""
	@echo "========================================="

check:
	@echo "ğŸ“‹ æ£€æŸ¥ä¾èµ–..."
	@command -v rustc >/dev/null 2>&1 || { echo "âŒ Rust æœªå®‰è£…"; exit 1; }
	@command -v solana >/dev/null 2>&1 || { echo "âŒ Solana CLI æœªå®‰è£…"; exit 1; }
	@command -v anchor >/dev/null 2>&1 || { echo "âŒ Anchor æœªå®‰è£…"; exit 1; }
	@command -v node >/dev/null 2>&1 || { echo "âŒ Node.js æœªå®‰è£…"; exit 1; }
	@echo "âœ… æ‰€æœ‰ä¾èµ–å·²å®‰è£…"

setup:
	@./setup.sh

install:
	@echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
	@yarn install || npm install
	@echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

build:
	@echo "ğŸ—ï¸  æ„å»ºç¨‹åº..."
	@anchor build
	@echo "âœ… æ„å»ºå®Œæˆ"

test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	@anchor test
	@echo "âœ… æµ‹è¯•å®Œæˆ"

test-skip-validator:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•ï¼ˆè·³è¿‡éªŒè¯å™¨ï¼‰..."
	@anchor test --skip-local-validator
	@echo "âœ… æµ‹è¯•å®Œæˆ"

deploy:
	@echo "ğŸ“¤ éƒ¨ç½²ç¨‹åº..."
	@anchor deploy
	@echo "âœ… éƒ¨ç½²å®Œæˆ"

clean:
	@echo "ğŸ§¹ æ¸…ç†æ„å»ºäº§ç‰©..."
	@anchor clean
	@rm -rf node_modules
	@echo "âœ… æ¸…ç†å®Œæˆ"

validator:
	@echo "ğŸ”§ å¯åŠ¨æœ¬åœ°éªŒè¯å™¨..."
	@solana-test-validator

logs:
	@echo "ğŸ“ æŸ¥çœ‹ç¨‹åºæ—¥å¿—..."
	@solana logs

wallet:
	@echo "ğŸ‘› é’±åŒ…ä¿¡æ¯ï¼š"
	@echo "åœ°å€: $$(solana address)"
	@echo "ä½™é¢: $$(solana balance)"

info:
	@echo "â„¹ï¸  ç¨‹åºä¿¡æ¯ï¼š"
	@echo "ç¨‹åº ID: 22222222222222222222222222222222222222222222"
	@echo "æ„å»ºäº§ç‰©: target/deploy/blueshift_anchor_escrow.so"
	@if [ -f target/deploy/blueshift_anchor_escrow.so ]; then \
		echo "ç¨‹åºæ–‡ä»¶å¤§å°: $$(ls -lh target/deploy/blueshift_anchor_escrow.so | awk '{print $$5}')"; \
	fi
